"use strict";function _classCallCheck(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,i){for(var s=0;s<i.length;s++){var e=i[s];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}return function(i,s,e){return s&&t(i.prototype,s),e&&t(i,e),i}}(),Crood=function(){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;_classCallCheck(this,t),this.x=i,this.y=s}return _createClass(t,[{key:"setCrood",value:function(t,i){this.x=t,this.y=i}},{key:"copy",value:function(){return new t(this.x,this.y)}}]),t}(),ShootingStar=function(){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Crood,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Crood,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:200,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;_classCallCheck(this,t),this.init=i,this.final=s,this.size=e,this.speed=n,this.dur=1e3*Math.sqrt(Math.pow(this.final.x-this.init.x,2)+Math.pow(this.final.y-this.init.y,2))/this.speed,this.pass=0,this.prev=this.init.copy(),this.now=this.init.copy(),this.onDistory=o}return _createClass(t,[{key:"draw",value:function(t,i){this.pass+=i,this.pass=Math.min(this.pass,this.dur);var s=this.pass/this.dur;this.now.setCrood(this.init.x+(this.final.x-this.init.x)*s,this.init.y+(this.final.y-this.init.y)*s),t.strokeStyle="#fff",t.lineCap="round",t.lineWidth=this.size,t.beginPath(),t.moveTo(this.now.x,this.now.y),t.lineTo(this.prev.x,this.prev.y),t.stroke(),this.prev.setCrood(this.now.x,this.now.y),this.pass===this.dur&&this.distory()}},{key:"distory",value:function(){this.onDistory&&this.onDistory()}}]),t}(),MeteorShower=function(){function t(i,s){_classCallCheck(this,t),this.cvs=i,this.ctx=s,this.stars=[],this.T,this.stop=!1,this.playing=!1}return _createClass(t,[{key:"createStar",value:function(){var t=this,i=Math.PI/3,s=400*Math.random(),e=new Crood(Math.random()*this.cvs.width|0,300*Math.random()|0),n=new Crood(e.x+s*Math.cos(i),e.y+s*Math.sin(i)),o=2*Math.random(),a=400*Math.random()+100,h=new ShootingStar(e,n,o,a,function(){t.remove(h)});return h}},{key:"remove",value:function(t){this.stars=this.stars.filter(function(i){return i!==t})}},{key:"update",value:function(t){var i=this;!this.stop&&this.stars.length<20&&this.stars.push(this.createStar()),this.stars.forEach(function(s){s.draw(i.ctx,t)})}},{key:"tick",value:function(){var t=this;if(!this.playing){this.playing=!0;var i=(new Date).getTime(),s=i,e=void 0;!function n(){if(t.stop&&0===t.stars.length)return cancelAnimationFrame(t.T),void(t.playing=!1);e=(e=i-s)>500?30:e<16?16:e,s=i,t.T=requestAnimationFrame(n),ctx.save(),ctx.globalCompositeOperation="destination-in",ctx.fillStyle="rgba(0,0,0,0.8)",ctx.fillRect(0,0,cvs.width,cvs.height),ctx.restore(),t.update(e)}()}}},{key:"start",value:function(){this.stop=!1,this.tick()}},{key:"stop",value:function(){this.stop=!0}}]),t}(),cvs=document.querySelector("canvas"),ctx=cvs.getContext("2d"),meteorShower=new MeteorShower(cvs,ctx);meteorShower.start();