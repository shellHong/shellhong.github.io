"use strict";var _autoCarouselHandle=null,_doAutoCarousel=function(){g_isParallelType||g_isAutoCarousel&&g_liChildrenLen>1&&null==_autoCarouselHandle&&(_autoCarouselHandle=setInterval(function(){_doEndAnimate(g_ul,0,"left")},g_opt.autoCarouselTime||5e3))},_unAutoCarousel=function(){null!=_autoCarouselHandle&&(clearInterval(_autoCarouselHandle),_autoCarouselHandle=null)},_sort=function(e){return e.splice(e.length-g_liCur,e.length).concat(e)},_isPercentage=function(e){return"[object string]"==_getDataType(e).toLowerCase()&&-1!=e.indexOf("%")},_getDataType=function(e){return Object.prototype.toString.call(e)},_isLastButOneLi=function(){return _getNextLiChildrenIndex()==g_startLiCur-1},_isLastButTwoLi=function(){return _getNextLiChildrenIndex()==g_startLiCur-2},_isLastLi=function(){return _getNextLiChildrenIndex()==g_startLiCur},_isFirstLi=function(){return _getLiChildrenIndex()==g_startLiCur},_isSecondLi=function(){return _getLiChildrenIndex()==g_startLiCur+2},_getParallelRate=function(){return _isLastLi()?1:_isLastButOneLi()?g_parallel_lastButOne_move/g_containerW:g_liWidth/g_containerW},_parallel_simple_rate=null,_getParallelSimpleRate=function(){return _parallel_simple_rate||(_parallel_simple_rate=g_liWidth/g_containerW),_parallel_simple_rate},_dealTEndListener=function(e,i,t){var l=[e];"[object array]"==Object.prototype.toString.call(e).toLowerCase()&&(l=e),l.forEach(function(e){t&&t(e,i)})},_addTEndListener=function(e,i){_dealTEndListener(e,i,function(e,i){e.addEventListener("webkitTransitionEnd",i),e.addEventListener("transitionend",i),e["data-fns"]||(e["data-fns"]=[]),e["data-fns"].push(i)})},_getMoveDistance=function(){return g_isParallelType||g_isParallelSimpleType?g_liWidth:g_containerW},_initUlPosition=function(){var e=g_liCur*_getMoveDistance();g_isParallelSimpleType&&(e-=g_parallel_startX),_setTranslate3d(g_ul,-e)},_fillIndexData=function(e){return e.map(function(e,i){return{url:e,index:i}})},_getData=function e(i){return i.length>0&&i.length<5?e(i.concat(i)):i},_initContainer=function(){g_container.style.position="relative"},_fillHtml=function(e){if(e){var i="";e.forEach(function(e){i+=LI_TEMPLATE.replace("{{url}}",e.url).replace("{{index}}",e.index)}),i=UL_TEMPLATE.replace("{{lis}}",i),g_container.innerHTML=i}},_initLiScale=function(){if(g_isScaleType){var e=_getLiChildrenIndex();g_liChildren.forEach(function(i,t){t!=e&&_setScale(g_liChildren[t],g_opt.rate)})}},_initLiRange=function(){g_liMax=g_liChildrenLen-1},_setTransform=function(e,i,t){i.test(e.style.transform)?e.style.transform=e.style.transform.replace(i,t):e.style.transform+=t},_setWebkitTransform=function(e,i,t){i.test(e.style.transform)?e.style.webkitTransform=e.style.webkitTransform.replace(i,t):e.style.webkitTransform+=t},_setTranslate3d=function(e,i){e["data-tx"]=i,_setTransform(e,/translate3d\([^)]+\)/," translate3d("+i+"px, 0, 0) "),_setWebkitTransform(e,/-webkit-translate3d\([^)]+\)/," -webkit-translate3d("+i+"px, 0, 0) ")},_setScale=function(e,i){_setTransform(e,/scaleY\([^)]+\)/," scaleY("+i+") "),_setWebkitTransform(e,/-webkit-scaleY\([^)]+\)/," -webkit-scaleY("+i+") ")},_setCurLiScale=function(e){if(g_isScaleType){e=Math.abs(e);var i=1-(1-g_opt.rate)*e/g_liWidth;i<g_opt.rate&&(i=g_opt.rate),_setScale(g_liChildren[_getLiChildrenIndex()],i)}},_seNextLiScale=function(e){if(g_isScaleType){var i=Math.abs(e),t=g_opt.rate+(1-g_opt.rate)*i/g_liWidth;t>1&&(t=1),e>0?_setScale(g_liChildren[_getPreLiChildrenIndex()],t):_setScale(g_liChildren[_getNextLiChildrenIndex()],t)}},_setNextLiParallel=function(e,i){if(g_isParallelType){var t=g_liChildren[_getNextLiChildrenIndex()],l=t["data-tx"];if(g_parallel_liAnimating){if(e<-g_parallel_dragHolder)return;if(e>0)return;_setTranslate3d(t,l+i)}else _isLastLi()&&(e<-g_parallel_dragHolder?(g_parallel_pre_liAnimating=!1,g_parallel_liAnimating=!0,_addEndAnimation(t,g_liChildren[_getLiChildrenIndex()]["data-tx"]+g_parallel_startX+g_liWidth,_setTranslate3d)):e<0&&(g_parallel_pre_liAnimating=!0,_setTranslate3d(t,l-i)))}},_setUlX=function(e,i){var t=e["data-tx"]||0;_setTranslate3d(e,i+t)},_initLiInfo=function(){g_liChildren.forEach(function(e,i){e.style.width=g_isParallelType||g_isParallelSimpleType?g_opt.width+"px":g_liWidth+"px",e.style.height=g_liHeight+"px"})},_period=0,_getDiffWhenMoveL=function(){return g_isParallelType?_isLastButTwoLi()?g_parallel_startX+(_period+=g_parallel_startX):g_parallel_startX+_period:0},_getDiffWhenMoveR=function(){if(g_isParallelType){if(_isSecondLi()){var e=-g_parallel_startX+_period;return _period-=g_parallel_startX,e}return _period}return 0},_getStaticDiff=function(){return g_isScaleType?g_opt.gap*g_liChildrenLen:0},_getDiffWhenInit=function(e){return g_isParallelType&&e>=g_liCur?g_parallel_startX:0},_preLiIndex={cur:null,real:0},_curLiIndexMap={cur:null,real:0},_nextLiIndexMap={cur:null,real:0},_getPreLiChildrenIndex=function(){if(g_liCur===_preLiIndex.cur)return _preLiIndex.real;var e=(g_liCur-1)%g_liChildrenLen;return e=e<0?e+g_liChildrenLen:e,_preLiIndex={cur:g_liCur,real:e},e},_getLiChildrenIndex=function(){if(g_liCur===_curLiIndexMap.cur)return _curLiIndexMap.real;var e=g_liCur%g_liChildrenLen;return e=e<0?e+g_liChildrenLen:e,_curLiIndexMap={cur:g_liCur,real:e},e},_getNextLiChildrenIndex=function(){if(g_liCur===_nextLiIndexMap.cur)return _nextLiIndexMap.real;var e=(g_liCur+1)%g_liChildrenLen;return e=e<0?e+g_liChildrenLen:e,_nextLiIndexMap={cur:g_liCur,real:e},e},_initLiPosition=function(){var e=_getStaticDiff();g_liChildren.forEach(function(i,t){_setTranslate3d(i,g_liWidth*t+e+_getDiffWhenInit(t))})},_initLiChildren=function(){g_liChildren=Array.prototype.slice.call(g_container.querySelectorAll("li")),g_liChildrenWithPos=g_liChildren.slice(0),g_liChildrenLen=g_liChildren.length},_getLiWidth=function(){return g_containerW=g_container.offsetWidth,g_isScaleType?(_isPercentage(g_opt.gap)&&(g_opt.gap=g_containerW*parseFloat(g_opt.gap.replace("%",""))/100),g_containerW-2*g_opt.gap):g_isParallelType||g_isParallelSimpleType?(_isPercentage(g_opt.width)&&(g_opt.width=g_containerW*parseFloat(g_opt.width.replace("%",""))/100),_isPercentage(g_opt.marginR)&&(g_opt.marginR=g_containerW*parseFloat(g_opt.marginR.replace("%",""))/100),g_isParallelType&&_isPercentage(g_opt.dragHolder)&&(g_opt.dragHolder=g_containerW*parseFloat(g_opt.dragHolder.replace("%",""))/100),g_opt.width+g_opt.marginR):g_containerW},_addEndAnimation=function(e,i,t){e.style.transition="transform "+(g_opt.animateTime||END_TIME)+"s ease-out",e.style.webkitTransition="-webkit-transform "+(g_opt.animateTime||END_TIME)+"s ease-out",e.offsetWidth,t(e,i),e.hasAddTEndListener||(e.hasAddTEndListener=!0,_addTEndListener(e,function(){_removeEndAnimation(e),_doAutoCarousel()}))},_removeEndAnimation=function(e){e.style.transition="unset",e.style.webkitTransition="unset",g_isEndAnimating=!1},_doEndAnimate=function(e,i,t){if(0!=i||t){var l=g_liChildren[_getNextLiChildrenIndex()],n=g_liChildren[_getLiChildrenIndex()],a=g_liChildren[_getPreLiChildrenIndex()];g_isEndAnimating=!0;r=g_effectDistance;if(g_isParallelType&&_isLastLi()&&(r=g_parallel_dragHolder),Math.abs(i)>r||t)if(i>0||"r"==t){g_isScaleType&&(_addEndAnimation(n,g_opt.rate,_setScale),_addEndAnimation(a,1,_setScale));r=g_liWidth;g_isParallelType&&(_isLastLi()?r=g_parallel_lastButOne_move:_isFirstLi()&&(r=g_containerW-g_marginR)),_addEndAnimation(e,r-i,_setUlX),_fixLiWhenMoveR()}else{g_isScaleType&&(_addEndAnimation(n,g_opt.rate,_setScale),_addEndAnimation(l,1,_setScale));var r=g_liWidth;g_isParallelType&&(_isLastButOneLi()?r=g_parallel_lastButOne_move:_isLastLi()&&(r=g_containerW-g_marginR)),_addEndAnimation(e,-r-i,_setUlX),_fixLiWhenMoveL()}else g_isScaleType&&(_addEndAnimation(n,1,_setScale),_addEndAnimation(l,g_opt.rate,_setScale),_addEndAnimation(a,g_opt.rate,_setScale)),g_isParallelType&&g_parallel_liAnimating&&_addEndAnimation(l,n["data-tx"]+g_parallel_startX+g_liWidth,_setTranslate3d),g_isParallelType&&g_parallel_pre_liAnimating&&(_setTranslate3d(l,n["data-tx"]+g_parallel_startX+g_liWidth),g_parallel_pre_liAnimating=!1),_addEndAnimation(e,-i,_setUlX)}},_fixLiWhenMoveL=function(){if(g_liMax-(g_liCur+1)<2){g_liMax++,g_liMin++;var e=g_liChildrenWithPos.shift();g_liChildrenWithPos.push(e),_setTranslate3d(e,g_liMax*g_liWidth+_getDiffWhenMoveL()+_getStaticDiff())}g_liCur++},_fixLiWhenMoveR=function(){if(g_liCur-1-g_liMin<2){g_liMin--,g_liMax--;var e=g_liChildrenWithPos.pop();g_liChildrenWithPos.unshift(e),_setTranslate3d(e,g_liMin*g_liWidth+_getDiffWhenMoveR()+_getStaticDiff())}g_liCur--},END_TIME=.2,LI_TEMPLATE="<li data-index='{{index}}' style='position:absolute;background-size: cover;background-image: url({{url}});-webkit-backface-visibility:hidden;backface-visibility:hidden;user-select:none;'></li>",UL_TEMPLATE="<ul style='position:relative;list-style-type:none;padding:0;margin:0;'>{{lis}}</ul>",g_container=null,g_effectDistance=30,g_containerW=0,g_liChildren=null,g_liChildrenWithPos=null,g_liChildrenLen=0,g_liWidth=0,g_liHeight=0,g_ul=null,g_isEndAnimating=!1,g_marginR=0,g_liMin=0,g_liMax=0,g_liCur=0,g_startLiCur=0,g_opt=null,g_isScaleType=!1,g_isAutoCarousel=!1,g_isParallelType=!1,g_isParallelSimpleType=!1,g_parallel_startX=0,g_parallel_rItemW=0,g_parallel_lastButOne_move=0,g_parallel_dragHolder=0,g_parallel_liAnimating=!1,g_parallel_pre_liAnimating=!1,g_dataLen=0,g_touchstartHandle=null,g_touchmoveHandle=null,g_touchendHandle=null,g_touchcancelHandle=null,g_reset=function(){g_container&&(g_container.removeEventListener("touchstart",g_touchstartHandle),g_container.removeEventListener("touchmove",g_touchmoveHandle),g_container.removeEventListener("touchend",g_touchendHandle),g_container.removeEventListener("touchcancel",g_touchcancelHandle)),g_container=null,g_effectDistance=30,g_containerW=0,g_liChildren=null,g_liChildrenWithPos=null,g_liChildrenLen=0,g_liWidth=0,g_liHeight=0,g_ul=null,g_isEndAnimating=!1,g_marginR=0,g_liMin=0,g_liMax=0,g_liCur=0,g_startLiCur=0,g_opt=null,g_isScaleType=!1,g_isAutoCarousel=!1,g_isParallelType=!1,g_isParallelSimpleType=!1,g_parallel_startX=0,g_parallel_rItemW=0,g_parallel_lastButOne_move=0,g_parallel_dragHolder=0,g_parallel_liAnimating=!1,g_parallel_pre_liAnimating=!1,g_dataLen=0,_autoCarouselHandle=null,_parallel_simple_rate=null,_period=0,_preLiIndex={cur:null,real:0},_curLiIndexMap={cur:null,real:0},_nextLiIndexMap={cur:null,real:0}},carousel={init:function(e,i){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};g_reset(),g_dataLen=i.length,g_container=e,g_opt=t,g_effectDistance=t.effectDistance||g_effectDistance,g_isScaleType="scale"==t.type,g_isParallelType="parallel"==t.type,g_isParallelSimpleType="parallel-simple"==t.type,g_isAutoCarousel=1==t.isAutoCarousel,i=_fillIndexData(i),i=_getData(i),g_liChildrenLen=i.length,g_startLiCur=g_liCur=Math.floor((g_liChildrenLen-1)/2),t.isSort&&(i=_sort(i)),_fillHtml(i),_initContainer(),g_liChildren=g_container.querySelectorAll("li");var l=1==g_liChildrenLen;g_ul=g_container.querySelector("ul"),g_liWidth=_getLiWidth(),g_liHeight=g_container.offsetHeight,g_marginR=g_opt.marginR,g_isParallelType&&(g_parallel_startX=t.startX,g_parallel_dragHolder=t.dragHolder,g_parallel_lastButOne_move=g_liWidth-(g_parallel_rItemW=g_containerW-g_liWidth-g_parallel_startX-g_marginR)),g_isParallelSimpleType&&(g_parallel_startX=t.startX),g_liChildrenLen&&(l||_initLiChildren(),_initLiInfo(),l||(_initLiPosition(),_initUlPosition(),_initLiScale(),_initLiRange(),this.addEvent()))},addEvent:function(){function e(){s=!1,r=0,_=0,g=0,o=0,g_parallel_liAnimating=!1,g_isEndAnimating=!1}function i(){_doEndAnimate(g_ul,g)}var t=0,l=0,n=0,a=0,r=0,_=0,g=0,o=0,s=!1,d=0,u=0;g_touchstartHandle=function(e){s=!0,t=e.touches[0].clientX,l=e.touches[0].clientY},g_container.addEventListener("touchstart",g_touchstartHandle),g_touchmoveHandle=function(i){if(s&&!g_isEndAnimating){var c=0==r&&0==_;if(d=i.touches[0].clientX,u=i.touches[0].clientY,r=d-(n||t),_=u-(a||l),g_isParallelType?r*=_getParallelRate():g_isParallelSimpleType&&(r*=_getParallelSimpleRate()),n=d,a=u,c){if(Math.abs(r)<Math.abs(_))return void e()}else _unAutoCarousel(),g+=r,o+=_,_setUlX(g_ul,r,g_isParallelType),_setCurLiScale(g),_seNextLiScale(g),_setNextLiParallel(g,r);i.preventDefault(),i.stopPropagation()}},g_container.addEventListener("touchmove",g_touchmoveHandle),g_touchendHandle=function(t){s&&(i(),e())},g_container.addEventListener("touchend",g_touchendHandle),g_touchcancelHandle=function(t){s&&(i(),e())},g_container.addEventListener("touchcancel",g_touchcancelHandle)}};